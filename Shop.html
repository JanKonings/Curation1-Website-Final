<!DOCTYPE html>
<html>
<head>
    <title>Shop Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="CSS/shop.css">
    <link rel="stylesheet" type="text/css" href="CSS/header.css">
    <script src="Javascript/script.js" defer></script>
</head>
<body>
    <div class="header">
        <button class="hamburgerNav" id="hamburgerNav">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </button>

        <ul id="nav">
            <li><a href="index.html">
                <img id="home" src="Images/HomePageLogo.JPG" />
            </a></li>
            <li><a href="Shop.html">Shop</a></li>
            <li><a href="AboutUs.html">About Us</a></li>
            <li><a href="Contact.html">Contact</a></li>
        </ul>

        <a id="cart" href="cart.html">
            <img id="cartIMG" src="Images/cart.png" />
        </a>
    </div>

    <div id="shopContainer">
        <div class="shopItem">
            <!-- Your product display here -->
        </div>
        
        <form id="shopForm">
            <div class="sizeOptions">
                <input type="radio" name="size" id="30" class="customRadio" value="30" required>
                <label for="30">30</label>
                <input type="radio" name="size" id="32" class="customRadio" value="32">
                <label for="32">32</label>
                <input type="radio" name="size" id="34" class="customRadio" value="34">
                <label for="34">34</label>
            </div>
            <button type="button" id="addToCart">Add to Cart</button>
        </form>

        <script>
        // Correct variant IDs (from your Shopify admin URL)
        const variantMapping = {
            "30": "gid://shopify/ProductVariant/48240682303721",
            "32": "gid://shopify/ProductVariant/48240682336489",
            "34": "gid://shopify/ProductVariant/48240682369257"
        };
        
        // Get selected size
        function getSelectedSize() {
            const selectedRadio = document.querySelector('input[name="size"]:checked');
            return selectedRadio ? selectedRadio.value : null;
        }
        
        // Add to cart button handler
        document.getElementById("addToCart").addEventListener("click", async function() {
            const selectedSize = getSelectedSize();
            
            if (!selectedSize) {
                alert("Please select a size.");
                return;
            }

            const variantId = variantMapping[selectedSize];
            if (!variantId) {
                alert("Invalid size selection.");
                return;
            }

            try {
                const checkoutUrl = await createCheckout(variantId);
                window.location.href = checkoutUrl;
            } catch (error) {
                console.error("Checkout error:", error);
                alert("Failed to proceed to checkout. Please try again.");
            }
        });

        // Create Shopify checkout
        async function createCheckout(variantId) {
            const accessToken = '56eabb2d60183cb4ad807f7f621fe66a'; // Your Storefront API token
            const shopDomain = 'y8hkdv-yg.myshopify.com'; // Your Shopify store domain
            
            const query = `
                mutation {
                    checkoutCreate(input: {
                        lineItems: [{
                            quantity: 1,
                            variantId: "${variantId}"
                        }]
                    }) {
                        checkout {
                            webUrl
                        }
                        checkoutUserErrors {
                            code
                            field
                            message
                        }
                    }
                }
            `;

            const response = await fetch(`https://${shopDomain}/api/2023-01/graphql.json`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Shopify-Storefront-Access-Token': accessToken,
                },
                body: JSON.stringify({ query }),
            });

            const data = await response.json();
            
            if (data.errors) {
                console.error("GraphQL Errors:", data.errors);
                throw new Error(data.errors[0].message);
            }

            if (data.data.checkoutCreate.checkoutUserErrors?.length > 0) {
                console.error("Checkout Errors:", data.data.checkoutCreate.checkoutUserErrors);
                throw new Error(data.data.checkoutCreate.checkoutUserErrors[0].message);
            }

            return data.data.checkoutCreate.checkout.webUrl;
        }
        </script>
    </div>
</body>
</html>